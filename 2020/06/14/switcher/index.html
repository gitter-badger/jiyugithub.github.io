


<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>  炫酷！从未见过如此Q弹的Switcher |    white.</title>
  <!-- 标签页图标 -->
  
  <!-- 图标库 -->
  <link href="https://cdn.jsdelivr.net/npm/remixicon@2.2.0/fonts/remixicon.css" rel="stylesheet">
  <!-- 动画库 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.0.0/animate.min.css"/>
  <!-- css文件 -->
  
<link rel="stylesheet" href="/css/white.css">

  <!-- 代码高亮 -->
  
    
      
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.1.1/styles/github.css">

    
  
  <!-- tocbot -->
  <!-- 
    
<link rel="stylesheet" href="/css/tocbot.css">

   -->
  <!-- 声明document.ready函数 -->
  <!-- <script>
      document.ready = function (callback) {
        ///兼容FF,Google
        if (document.addEventListener) {
          document.addEventListener('DOMContentLoaded', function () {
            document.removeEventListener('DOMContentLoaded', arguments.callee, false);
            callback();
          }, false)
        }
        //兼容IE
        else if (document.attachEvent) {
          document.attachEvent('onreadystatechange', function () {
            if (document.readyState == "complete") {
              document.detachEvent("onreadystatechange", arguments.callee);
              callback();
            }
          })
        }
        else if (document.lastChild == document.body) {
          callback();
        }
      }
  </script> -->
<meta name="generator" content="Hexo 4.2.1"></head>


<body>
<div class="menu-outer">
    <div class="menu-inner">
      <div class="menu-site-name  animate__animated  animate__fadeInUp">
        <a href="/">
          white.
        </a>
        
      </div>
      <div class="menu-group">
        <ul class="menu-ul">
        
          <a href="/" class="nav-link">
            <li class="menu-li  animate__animated  animate__fadeInUp">
              HOME
            </li>
          </a>
        
          <a href="/archives" class="nav-link">
            <li class="menu-li  animate__animated  animate__fadeInUp">
              BLOG
            </li>
          </a>
        
        
        <a href="/search">
          <li class="menu-li  animate__animated  animate__fadeInUp">
            <i class="ri-search-line"></i>
          </li>
        </a>
        
        
       
          <li class="menu-li animate__animated  animate__fadeInUp" id="mobile-menu">
            <i class="ri-menu-line"></i>
          </li>
        
        </ul>

      </div>

    </div>
</div>
<div id="mobile-main" class="animate__animated  animate__fadeIn">
  <div class="mobile-menu-inner">
    <div class="mobile-menu-site-name  animate__animated  animate__fadeInUp">
      <a href="/">
        white.
      </a>
    </div>
    <div class="mobile-menu-group" id="mobile-close">
      <i class="ri-close-line"></i>
    </div>

  </div>

  <div class="mobile-menu-div">
  
    <a href="/" class="mobile-nav-link">
      <div class="mobile-menu-child animate__animated  animate__fadeInUp">
        <span>HOME</span>
      </div>
    </a>
  
    <a href="/archives" class="mobile-nav-link">
      <div class="mobile-menu-child animate__animated  animate__fadeInUp">
        <span>BLOG</span>
      </div>
    </a>
  
  
    <a href="/search">  
      <div class="mobile-menu-child  animate__animated  animate__fadeInUp">
        <i class="ri-search-line"></i>
      </div>
    </a>
    
  </div>


</div>

<div class="body-outer">
  <div class="body-inner">
    
<article class="post-inner">
  <div class="post-content-outer">
    <div class="post-content-inner ">
      <div class="post-intro">
        <div class="post-title animate__animated  animate__fadeInUp">炫酷！从未见过如此Q弹的Switcher</div>
        <div class="meta-intro animate__animated  animate__fadeInUp"><span class="intro-span">2020年6月14日 by Apocalypse</span></div>
        
          <div class="post-cover animate__animated  animate__fadeInUp"><img src="/assets/title.jpg/" class="post-cover-img"></div>
        
      </div>
      <div class="post-content-main animate__animated  animate__fadeInUp">
        <!-- 目录 -->
        
          
        
        <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>最近逛<code>Dribbble</code>的时候，看到了一个非常酷的<code>Switcher</code>动画，特别喜欢，本想着试着用代码在Android平台来实现一下，没想到已经有实现的版本，并且作者还写了文章分享，思路清晰，各个实现关键点都讲的特别清楚，因此就译诚中文，分享大家，正如作者最后所说，大家一定要运行试试，效果非常赞！</p>
<blockquote>
<p>原作者：<a href="https://android.jlelse.eu/@bitvale?source=post_page-----433258cbb80f----------------------" target="_blank" rel="noopener">Alexander Kolpakov</a> 译者：<a href="https://www.jianshu.com/u/35167a70aa39" target="_blank" rel="noopener">依然范特稀西</a> 地址：<a href="http://suo.im/60UJjT" target="_blank" rel="noopener">http://suo.im/60UJjT</a></p>
</blockquote>
<a id="more"></a>

<h3 id="正文开始"><a href="#正文开始" class="headerlink" title="正文开始"></a>正文开始</h3><p>最近，我写了一篇关于实现Dribbble上的一个漂亮设计的文章。得到了很多积极的反馈，对我来说，这给了我很大的动力。我非常高兴能获得这些反馈，同时我也很乐意分享我的经验。</p>
<p>在本文中，我们将尝试逐步实现由<code>Oleg Frolov</code>创建的另一个精美的动画。这与上一篇文章中的复杂动画UI无关，它是一个自定义小控件。但是它有着非常精美漂亮的动画设计，如下所示：</p>
<p><img src="http://user-gold-cdn.xitu.io/2020/3/12/170cd50c1a6eecc9?imageslim" alt="swicher.gif">swicher.gif</p>
<p>乍一看，实现这样的切换似乎并不简单，但我认为那是因为动画非常漂亮。如 你所见，创建相同的动画并不难。让我们一步一步地来实现它。</p>
<p>第一步，我们需要自定义View,并且实现它的3个构造方法：</p>
<pre><code>class Switcher @JvmOverloads constructor(
        context: Context,
        attrs: AttributeSet ? = null,
        defStyleAttr: Int = 0
) : View(context, attrs, defStyleAttr) {

    init {
        attrs?.let { retrieveAttributes(attrs, defStyleAttr) }
    }

    private fun retrieveAttributes(attrs: AttributeSet, defStyleAttr: Int) {
        // retrieve cutom attributes
    }

    override fun onMeasure(widthMeasureSpec: Int, heightMeasureSpec: Int) {
        // setup switcher width and height
    }

    override fun onSizeChanged(w: Int, h: Int, oldw: Int, oldh: Int) {
        // setup helper sizes every time switcher size changed (radius, icon width...)
    }

    override fun onDraw(canvas: Canvas ?) {
        // just draw
    }
}
</code></pre><h3 id="接下来开始绘制"><a href="#接下来开始绘制" class="headerlink" title="接下来开始绘制"></a>接下来开始绘制</h3><p>在默认（选中）状态下，我们的开关由2个圆角矩形（绿色和白色）组成</p>
<p><img src="http://user-gold-cdn.xitu.io/2020/3/12/170cd50c1f123a19?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p>
<p>绘制它们非常简单，我们只需要计算白色矩形的位置并将偏移量<code>iconTranslateX</code>传递给Android KTX <code>Canvas.withTranslation</code>扩展即可：</p>
<pre><code>override fun onDraw(canvas: Canvas ?) {
  // draw switcher (green rect)
  canvas?.drawRoundRect(switcherRect, switcherCornerRadius, switcherCornerRadius, switcherPaint)

  // draw icon (white rect)
  canvas?.withTranslation(x = iconTranslateX) {
      drawRoundRect(iconRect, switcherCornerRadius, switcherCornerRadius, iconPaint)
  }
}
</code></pre><h3 id="开始分解动画"><a href="#开始分解动画" class="headerlink" title="开始分解动画"></a>开始分解动画</h3><p>动画部分，我们使用<code>ValueAnimator</code>来实现，使用它的<code>ofFloat(float... values)</code>方法,我们需要三个动画：</p>
<ul>
<li>1、<code>switcherAnimator</code>: 切换器图标动画，从白色矩形到圆形，反之亦然</li>
<li>2、<code>translateAnimator</code>: 为切换器图标从左到右的过渡设置动画，反之亦然；</li>
<li>3、<code>colorAnimator</code>: 将颜色从绿色（选中）更改为红色，反之亦然。</li>
</ul>
<p>让我们先看一下<code>switcherAnimator</code>动画，设置<code>0</code>为动画的开始值，<code>1</code>为动画的结束值。</p>
<pre><code>// ...
var amplitude = BOUNCE_ANIM_AMPLITUDE_IN
var frequency = BOUNCE_ANIM_FREQUENCY_IN
var newProgress = 1f

if (!checked) {
    amplitude = BOUNCE_ANIM_AMPLITUDE_OUT
    frequency = BOUNCE_ANIM_FREQUENCY_OUT
    newProgress = 0f
}

val switcherAnimator = ValueAnimator.ofFloat(iconProgress, newProgress).apply {
    addUpdateListener {
        iconProgress = it.animatedValue as Float
    }
    interpolator = BounceInterpolator(amplitude, frequency)
    duration = SWITCHER_ANIMATION_DURATION
}
// ...
</code></pre><p>我们可以使用 <a href="https://github.com/evgenyneu" target="_blank" rel="noopener">Evgenii Neumerzhitckii</a> 写的<code>BounceInterpolator</code>来实现反弹效果，这非常适合我们的动画场景，不了解的可以看一下这片文章：<a href="https://evgenii.com/blog/spring-button-animation-on-android/" target="_blank" rel="noopener">evgenii.com/blog/spring…</a>，它解释了<code>BounceInterpolator</code>是如何工作的。</p>
<p>在Android KTX <code>addUpdateListener</code>扩展中，我们更新了<code>progress</code>的值，然后触发<code>invalidate</code>方法，最后重新绘制了视图。</p>
<pre><code>private var iconProgress = 0f
  set(value) {
      if (field != value) {
          field = value

          val iconOffset = lerp(0f, iconRadius - iconCollapsedWidth / 2, value)
          iconRect.left = width - switcherCornerRadius - iconCollapsedWidth / 2 - iconOffset
          iconRect.right = width - switcherCornerRadius + iconCollapsedWidth / 2 + iconOffset

          postInvalidateOnAnimation()
      }
  }
</code></pre><p><code>lerp</code>方法类似一个线性插值器，它用于计算<code>iconOffset</code>,反过来，它也用于计算<code>Swicher</code>图标的圆角矩形坐标。此图标的矩形从一个圆角矩形变为一个圆形（圆角半径较大的圆角矩形）。</p>
<blockquote>
<p>我们使用了<code>postInvalidateOnAnimation()</code>代替<code>postIvalidate</code>,是因为我们需要平滑的动画，并且第一个方法有优势，详情请看：<a href="https://stackoverflow.com/questions/29219372/postinvalidateonanimation-vs-postinvalidate/42648958#42648958" target="_blank" rel="noopener">stackoverflow.com/questions/2…</a></p>
</blockquote>
<p><code>translateAnimator</code>的工作方式相同，但是会更新<code>Swicher</code>图标的<code>x</code>位置。</p>
<p><img src="http://user-gold-cdn.xitu.io/2020/3/12/170cd50c209a787a?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p>
<p>如你所见，我们的白色圆圈就像百吉饼。我们有2种制作方法：</p>
<ul>
<li>裁剪一个较小的圆圈</li>
<li>最简单的圆圈，只需在顶部绘制另一个小圆圈，然后用切换器颜色填充即可。</li>
</ul>
<p>我选择较简单的一种。</p>
<p>这一切，没什么难的！我们现在有一个漂亮的自定义小控件并且带有精美的动画！</p>
<h3 id="至此，我们一切都可以了"><a href="#至此，我们一切都可以了" class="headerlink" title="至此，我们一切都可以了"></a>至此，我们一切都可以了</h3><p>现在，我们可以使用任何类型的动画来创建自定义视图，而且我们可以稍微更改代码以创建另一个由<code>Oleg Frolov</code>设计的<code>Swicher</code>小部件。仅需将视图轮廓从圆角矩形更新为圆形，并禁用平移动画。就是这么简单。</p>
<p><img src="http://user-gold-cdn.xitu.io/2020/3/12/170cd50c223d523d?imageslim" alt="swicherX.gif">swicherX.gif</p>
<h3 id="Talk-is-Chep，Just-show-Code"><a href="#Talk-is-Chep，Just-show-Code" class="headerlink" title="Talk is Chep，Just show Code"></a>Talk is Chep，Just show Code</h3><p>随意获取GitHub上的源代码，查看我的其他实现，别忘了尝试一下！ Github: <a href="https://github.com/bitvale/Switcher" target="_blank" rel="noopener">github.com/bitvale/Swi…</a></p>

        <!-- 分类文章 -->
        
          <div class="post-categoris-bottom">
            <div class="post-categoris-name">Category1</div>
            <ul>
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
              
                <li class="me base">
                  <a  href="/2020/06/14/switcher/" class="post-categoris-bottom-link">
                  炫酷！从未见过如此Q弹的Switcher
                </a>
                </li>
              
              
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            </ul>

          </div>

        
        <!-- 评论 -->
        
          
            <section id="comments" class="comments" style="margin-top: 150px;">
              <style>
                .comments{background:#fff}
                @media screen and (max-width:900px){.comments{margin:auto;padding:10px;background:#fff}}
              </style>
              <div id="vcomment" class="comment"></div>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src='//unpkg.com/valine/dist/Valine.min.js'></script>
<script src="https://cdnjs.loli.net/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script>
    var notify = 'true' == true ? true : false;
    var verify = 'false' == true ? true : false;
    new Valine({
        av: AV,
        el: '#vcomment',
        notify: notify,
        app_id: "GpGkfBlXUXHdzTB4tqH7SPnb",
        app_key: "FihoucantYlc5U1FQ9BzkO3l",
        placeholder: "留下你来过的痕迹~",
        avatar:"robohash",
    });
</script>

          </section>
        
        
      </div>
   </div>
  </div>
</article>
  </div>
</div>

  <div class="footer-outer animate__animated  animate__fadeInUp">
    <div class="footer-inner">
    <div class="footer-text">
    <p>Power by <a href="http://hexo.io/" target="_blank" rel="noopener">Hexo</a></p>

    </div>
    <div class="footer-contact">
    <ul class="footer-ul">
        
        <li class="footer-li">
            <a href="mailto:2391624941@qq.com" target="_blank">
                <i class="ri-mail-line"></i>
            </a>
        </li>
        
        <li class="footer-li">
            <a href="https://github.com/jiyugithub" target="_blank">
                <i class="ri-github-line"></i>
            </a>
        </li>
        
        <li class="footer-li">
            <a href="http://music.163.com/m/user/home?id=627503095" target="_blank">
                <i class="ri-netease-cloud-music-line"></i>
            </a>
        </li>
        
    </ul>
    </div>
    </div>
</div>



<script src="/js/white.js"></script>



    
      
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.1/build/highlight.min.js"></script>

      <script>hljs.initHighlightingOnLoad();</script>
    


  
<script src="/js/tocbot.min.js"></script>


</body>
</html>
